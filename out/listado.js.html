<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: listado.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: listado.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Controlador para la página de Listado de Películas.
 * Maneja la visualización de datos, la funcionalidad de votación y eliminación de películas.
 * @module listado
 */

/**
 * Controlador para la página de Listado de Películas.
 * Se ejecuta cuando el DOM está completamente cargado.
 * @event DOMContentLoaded
 */
document.addEventListener('DOMContentLoaded', () => {

    /**
     * Referencia al elemento tabla donde se mostrarán las películas.
     * @type {HTMLTableElement}
     */
    const tablaPeliculas = document.getElementById('tablaPeliculas');

    /**
     * Mapea los IDs de género a sus nombres.
     * @param {number[]} ids - Array de IDs de género.
     * @param {Genero[]} todosGeneros - Lista completa de géneros.
     * @returns {string} Una cadena con los nombres de los géneros separados por coma.
     */
    function obtenerNombresGeneros(ids, todosGeneros) {
        if (!ids || ids.length === 0) return 'Sin género';
        
        return ids.map(id => {
            const genero = todosGeneros.find(g => g.id === id);
            return genero ? genero.nombre : 'Desconocido';
        }).join(', ');
    }

    /**
     * Formatea una fecha de AAAA-MM-DD a DD/MM/AAAA.
     * @param {string} fechaStr - Fecha en formato AAAA-MM-DD.
     * @returns {string} Fecha formateada en DD/MM/AAAA.
     */
    function formatearFecha(fechaStr) {
        if (!fechaStr) return '';
        const partes = fechaStr.split('-');
        if (partes.length === 3) {
            return `${partes[2]}/${partes[1]}/${partes[0]}`;
        }
        return fechaStr;
    }

    /**
     * Guarda la puntuación de una película específica y repinta la tabla.
     * @param {number} peliculaId - ID de la película a votar.
     * @param {number} voto - Valor del voto (1-10).
     */
    function votarPelicula(peliculaId, voto) {
        const peliculas = DataService.getPeliculas();
        
        // Encontramos la película en la colección
        const pelicula = peliculas.find(p => p.id === peliculaId);

        if (pelicula) {
            // Usamos el método 'votar' que definimos en la clase Pelicula (app.js)
            pelicula.votar(voto);
            // Guardamos la colección actualizada en LocalStorage
            DataService.guardarPeliculas(peliculas);
            
            // Repintamos la tabla para ver el cambio reflejado al instante
            pintarListado();
            alert(`Gracias por tu voto (${voto}) para: ${pelicula.titulo}`);
        } else {
            console.error(`Película con ID ${peliculaId} no encontrada.`);
        }
    }

    /**
     * Elimina una película de la colección.
     * @param {number} peliculaId - ID de la película a eliminar.
     */
    function eliminarPelicula(peliculaId) {
        let peliculas = DataService.getPeliculas();
        peliculas = peliculas.filter(p => p.id !== peliculaId);
        DataService.guardarPeliculas(peliculas);
        pintarListado();
        alert("Película eliminada correctamente.");
    }

    /**
     * Renderiza la tabla completa de películas con todas sus columnas y botones de acción.
     * Si no hay películas, muestra un mensaje informativo.
     * @function pintarListado
     */
    function pintarListado() {
        const peliculas = DataService.getPeliculas();
        const generos = DataService.getGeneros();

        if (peliculas.length === 0) {
            tablaPeliculas.innerHTML = '&lt;tr>&lt;td>No hay películas registradas.&lt;/td>&lt;/tr>';
            return;
        }

        // 1. Crear encabezado de la tabla (THEAD)
        const thead = document.createElement('thead');
        thead.innerHTML = `
            &lt;tr>
                &lt;th>Título&lt;/th>
                &lt;th>Fecha de Estreno&lt;/th>
                &lt;th>Popularidad (0-100)&lt;/th>
                &lt;th>Géneros&lt;/th>
                &lt;th>Puntuación Media&lt;/th>
                &lt;th>Votos Totales&lt;/th>
                &lt;th>Acción&lt;/th>
            &lt;/tr>
        `;

        // 2. Crear cuerpo de la tabla (TBODY)
        const tbody = document.createElement('tbody');

        peliculas.forEach(peli => {
            const tr = document.createElement('tr');
            
            // Formatear fecha a DD/MM/AAAA
            const fechaFormateada = formatearFecha(peli.fecha);
            
            // Celdas de información
            tr.innerHTML = `
                &lt;td>${peli.titulo}&lt;/td>
                &lt;td>${fechaFormateada}&lt;/td>
                &lt;td>${peli.popularidad}&lt;/td>
                &lt;td>${obtenerNombresGeneros(peli.generos, generos)}&lt;/td>
                &lt;td>${peli.puntuacionMedia} / 10&lt;/td>
                &lt;td>${peli.numeroVotos}&lt;/td>
            `;

            // Celda de Acción (VOTAR, MODIFICAR y ELIMINAR)
            const tdAccion = document.createElement('td');
            tdAccion.style.display = 'flex';
            tdAccion.style.gap = '5px';
            tdAccion.style.justifyContent = 'center';
            tdAccion.style.flexWrap = 'wrap';
            
            // Creamos el botón Votar
            const btnVotar = document.createElement('button');
            btnVotar.textContent = "Votar (1-10)";
            btnVotar.classList.add('button-33');
            btnVotar.style.fontSize = "12px";
            btnVotar.style.padding = "2px 10px";
            
            // Agregamos el evento de votación
            btnVotar.addEventListener('click', () => {
                let voto = prompt(`Vota por ${peli.titulo}. Introduce un valor del 1 al 10:`);
                voto = parseInt(voto);

                if (voto >= 1 &amp;&amp; voto &lt;= 10) {
                    votarPelicula(peli.id, voto);
                } else if (voto !== null) { // Evitamos el mensaje si el usuario cancela
                    alert("Voto inválido. Debe ser un número entre 1 y 10.");
                }
            });

            // Creamos el botón Modificar
            const btnModificar = document.createElement('button');
            btnModificar.textContent = "Modificar";
            btnModificar.classList.add('button-33');
            btnModificar.style.fontSize = "12px";
            btnModificar.style.padding = "2px 10px";
            btnModificar.style.backgroundColor = "#007bff";
            btnModificar.style.color = "white";
            
            // Agregamos el evento de modificación
            btnModificar.addEventListener('click', () => {
                // Guardamos el ID en sessionStorage para que peliculas.js lo lea
                sessionStorage.setItem('editarPeliculaId', peli.id);
                // Redirigimos a la página de películas
                window.location.href = 'peliculas.html';
            });

            // Creamos el botón Eliminar
            const btnEliminar = document.createElement('button');
            btnEliminar.textContent = "Eliminar";
            btnEliminar.classList.add('button-33');
            btnEliminar.style.fontSize = "12px";
            btnEliminar.style.padding = "2px 10px";
            btnEliminar.style.backgroundColor = "#dc3545";
            btnEliminar.style.color = "white";
            
            // Agregamos el evento de eliminación
            btnEliminar.addEventListener('click', () => {
                if (confirm(`¿Estás seguro de que quieres eliminar "${peli.titulo}"?`)) {
                    eliminarPelicula(peli.id);
                }
            });

            tdAccion.appendChild(btnVotar);
            tdAccion.appendChild(btnModificar);
            tdAccion.appendChild(btnEliminar);
            tr.appendChild(tdAccion);
            tbody.appendChild(tr);
        });

        // 3. Limpiar y montar la tabla
        tablaPeliculas.innerHTML = '';
        tablaPeliculas.appendChild(thead);
        tablaPeliculas.appendChild(tbody);
    }

    /**
     * Inicializa el listado al cargar la página.
     */
    pintarListado();
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-CMDBLogic.html">CMDBLogic</a></li><li><a href="module-app.html">app</a></li><li><a href="module-generos.html">generos</a></li><li><a href="module-listado.html">listado</a></li><li><a href="module-peliculas.html">peliculas</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-CMDBLogic-DataService.html">DataService</a></li><li><a href="module-app-DataService.html">DataService</a></li></ul><h3>Classes</h3><ul><li><a href="module-CMDBLogic-Genero.html">Genero</a></li><li><a href="module-CMDBLogic-Pelicula.html">Pelicula</a></li><li><a href="module-app-Genero.html">Genero</a></li><li><a href="module-app-Pelicula.html">Pelicula</a></li></ul><h3>Events</h3><ul><li><a href="module-peliculas.html#~event:DOMContentLoaded">DOMContentLoaded</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sun Dec 07 2025 01:56:21 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
